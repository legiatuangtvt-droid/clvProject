# Plan v1.1.0: Biên bản kiểm kê - Chế độ rút gọn

## Context
- Hiện tại file Word biên bản kiểm kê dài 158 trang, quá dài để in đi kiểm kê thực tế
- Cần thêm chế độ "Bản rút gọn" chỉ giữ lại dòng đầu tiên của tên thiết bị, bỏ phần mô tả chi tiết
- Giúp giảm đáng kể số trang khi in file Word
- **Branch**: `feature/v1.1.0-inventory-compact-mode`
- **Version**: v1.1.0 (MINOR - feature mới)

## Logic rút gọn tên thiết bị

**Input (tên đầy đủ):**
```
Bộ thiết bị để vẽ trên bảng trong dạy học toán
Bộ thiết bị để vẽ trên bảng gồm:

- 01 chiếc thước thẳng dài tối thiểu 500mm, độ chia nhỏ nhất là 1mm;
- 01 chiếc compa dài 400mm...

Tất cả các thiết bị trên được làm bằng nhựa/gỗ...
```

**Output (rút gọn):**
```
Bộ thiết bị để vẽ trên bảng trong dạy học toán
```

**Thuật toán `getCompactName(name)`:**
1. Split theo `\n` (xuống dòng), lấy dòng đầu tiên không rỗng
2. Nếu dòng đó vẫn dài (> 100 ký tự) và chứa dấu `.` theo sau bởi text → cắt tại dấu `.` đầu tiên
3. Trim khoảng trắng

**Khi compact mode bật:**
- `child.name` → `getCompactName(child.name)` (chỉ dòng đầu)
- `child.description` → ẩn hoàn toàn (không render div `.inv-desc`)

## Các file cần thay đổi

| # | File | Thay đổi |
|---|------|----------|
| 1 | `public/manager-device.html` | Thêm toggle button "Bản đầy đủ / Bản rút gọn" vào modal |
| 2 | `public/js/manager-device.js` | Thêm logic compact mode: state, hàm rút gọn, toggle handler |
| 3 | `public/css/manager-device.css` | Style cho toggle button |

## Chi tiết triển khai

### Step 1: Thêm toggle button vào HTML modal
- Vị trí: giữa `<h2>` và `#inventory-preview-container`
- UI: Toggle switch với 2 label "Bản đầy đủ" / "Bản rút gọn"
- ID: `#compact-mode-toggle`

```html
<div class="inventory-mode-toggle">
    <label class="toggle-switch">
        <input type="checkbox" id="compact-mode-toggle">
        <span class="toggle-slider"></span>
    </label>
    <span id="compact-mode-label">Bản đầy đủ</span>
</div>
```

### Step 2: Thêm CSS cho toggle switch
- Style toggle switch (slider) phù hợp với design hiện tại
- Style cho `.inventory-mode-toggle` container
- Responsive mobile

### Step 3: Thêm logic JS
1. **Biến state:** `let isCompactMode = false;`
2. **Hàm `getCompactName(name)`:** rút gọn tên thiết bị theo thuật toán ở trên
3. **Sửa `renderInventoryTreeRows()`:** nhận thêm param `compact`, khi compact=true:
   - Dùng `getCompactName(child.name)` thay vì `child.name`
   - Không render div `.inv-desc` (ẩn description)
4. **Sửa `buildInventoryHTML()`:** nhận thêm param `compact`, truyền xuống `renderInventoryTreeRows()`
5. **Toggle handler:**
   - Lắng nghe sự kiện `change` trên `#compact-mode-toggle`
   - Khi toggle: `saveInventoryFields()` → đổi state → rebuild HTML → `restoreInventoryFields()`
   - Cập nhật label text: "Bản đầy đủ" ↔ "Bản rút gọn"
6. **Sửa `openInventoryPreview()`:** truyền `isCompactMode` vào `buildInventoryHTML()`

### Step 4: Đảm bảo Word export hoạt động đúng
- `downloadInventoryWord()` lấy `inventoryPreviewContainer.innerHTML` → tự động đúng theo mode hiện tại
- Không cần sửa hàm này

## Tracking

| Step | Mô tả | Status |
|------|--------|--------|
| 1 | Thêm toggle button vào HTML modal | ⬜ pending |
| 2 | Thêm CSS cho toggle switch | ⬜ pending |
| 3 | Thêm logic JS (compact mode) | ⬜ pending |
| 4 | Test: preview đầy đủ ↔ rút gọn + export Word | ⬜ pending |

## Verification
- [ ] Toggle switch hiển thị đúng trên desktop và mobile
- [ ] Bản đầy đủ: hiển thị y như hiện tại (không thay đổi gì)
- [ ] Bản rút gọn: tên thiết bị chỉ có dòng đầu, không có mô tả
- [ ] Chuyển đổi giữa 2 chế độ không mất dữ liệu đã nhập (quantity, broken, members...)
- [ ] Export Word ở chế độ rút gọn → file ngắn hơn đáng kể
- [ ] Export Word ở chế độ đầy đủ → y như cũ
